/*! asmsimulator 25-09-2021 */
var app=angular.module("ASMSimulator",[]);app.service("assembler",["opcodes",function(a){return{go:function(b){for(var c=/^[\t ]*(?:([.A-Za-z]\w*)[:])?(?:[\t ]*([A-Za-z]{2,4})(?:[\t ]+(\[(\w+((\+|-)\d+)?)\]|\".+?\"|\'.+?\'|[.A-Za-z0-9]\w*)(?:[\t ]*[,][\t ]*(\[(\w+((\+|-)\d+)?)\]|\".+?\"|\'.+?\'|[.A-Za-z0-9]\w*))?)?)?/,d=3,e=7,f=/^[-+]?[0-9]+$/,g=/^[.A-Za-z]\w*$/,h=[],i={},j={},k={},l=b.split("\n"),m=function(a){if("0x"===a.slice(0,2))return parseInt(a.slice(2),16);if("0o"===a.slice(0,2))return parseInt(a.slice(2),8);if("b"===a.slice(a.length-1))return parseInt(a.slice(0,a.length-1),2);if("d"===a.slice(a.length-1))return parseInt(a.slice(0,a.length-1),10);if(f.exec(a))return parseInt(a,10);throw"Invalid number format"},n=function(a){return a=a.toUpperCase(),"A"===a?0:"B"===a?1:"C"===a?2:"D"===a?3:"SP"===a?4:void 0},o=function(a){a=a.toUpperCase();var b=0,c=0;if("A"===a[0])c=0;else if("B"===a[0])c=1;else if("C"===a[0])c=2;else if("D"===a[0])c=3;else{if("SP"!==a.slice(0,2))return void 0;c=4}var d=1;if(4===c&&(d=2),"-"===a[d])b=-1;else{if("+"!==a[d])return void 0;b=1}var e=b*parseInt(a.slice(d+1),10);if(-16>e||e>15)throw"offset must be a value between -16...+15";return 0>e&&(e=32+e),8*e+c},p=function(a,b,c){var d=n(a);if(void 0!==d)return{type:b,value:d};var e=q(a);if(void 0!==e)return{type:c,value:e};if("regaddress"===b&&(d=o(a),void 0!==d))return{type:b,value:d};var f=m(a);if(isNaN(f))throw"Not a "+c+": "+f;if(0>f||f>255)throw c+" must have a value between 0-255";return{type:c,value:f}},q=function(a){return g.exec(a)?a:void 0},r=function(a){switch(a.slice(0,1)){case"[":var b=a.slice(1,a.length-1);return p(b,"regaddress","address");case'"':for(var c=a.slice(1,a.length-1),d=[],e=0,f=c.length;f>e;e++)d.push(c.charCodeAt(e));return{type:"numbers",value:d};case"'":var g=a.slice(1,a.length-1);if(g.length>1)throw"Only one character is allowed. Use String instead";return{type:"number",value:g.charCodeAt(0)};default:return p(a,"register","number")}},s=(function(a){var b=a.toUpperCase();if(b in k)throw"Duplicate label: "+a;if("A"===b||"B"===b||"C"===b||"D"===b)throw"Label contains keyword: "+b;j[a]=h.length}),t=function(a,b){if(void 0!==b)throw a+": too many arguments"},u=function(a,b){if(b>4)throw"Invalid register";return a+b},v=0,w=l.length;w>v;v++)try{var x=c.exec(l[v]);if(void 0!==x[1]||void 0!==x[2]){if(void 0!==x[1]&&s(x[1]),void 0!==x[2]){var y,z,A,B=x[2].toUpperCase();switch("DB"!==B&&(i[h.length]=v),B){case"DB":if(y=r(x[d]),"number"===y.type)h.push(y.value);else{if("numbers"!==y.type)throw"DB does not support this operand";for(var C=0,D=y.value.length;D>C;C++)h.push(y.value[C])}break;case"HLT":t("HLT",x[d]),A=a.NONE,h.push(A);break;case"MOV":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.MOV_REG_TO_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.MOV_ADDRESS_TO_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.MOV_REGADDRESS_TO_REG_A,y.value);else if("address"===y.type&&"register"===z.type)A=u(a.MOV_REG_TO_ADDRESS_A,z.value);else if("regaddress"===y.type&&"register"===z.type)A=u(a.MOV_REG_TO_REGADDRESS_A,z.value);else if("register"===y.type&&"number"===z.type)A=u(a.MOV_NUMBER_TO_REG_A,y.value);else if("address"===y.type&&"number"===z.type)A=a.MOV_NUMBER_TO_ADDRESS;else{if("regaddress"!==y.type||"number"!==z.type)throw"MOV does not support this operands";A=a.MOV_NUMBER_TO_REGADDRESS}"register"===y.type?h.push(A,z.value):"register"===z.type?h.push(A,y.value):h.push(A,y.value,z.value);break;case"ADD":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.ADD_REG_TO_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.ADD_REGADDRESS_TO_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.ADD_ADDRESS_TO_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"ADD does not support this operands";A=u(a.ADD_NUMBER_TO_REG_A,y.value)}h.push(A,z.value);break;case"SUB":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.SUB_REG_FROM_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.SUB_REGADDRESS_FROM_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.SUB_ADDRESS_FROM_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"SUB does not support this operands";A=u(a.SUB_NUMBER_FROM_REG_A,y.value)}h.push(A,z.value);break;case"INC":if(y=r(x[d]),t("INC",x[e]),"register"!==y.type)throw"INC does not support this operand";A=u(a.INC_REG_A,y.value),h.push(A);break;case"DEC":if(y=r(x[d]),t("DEC",x[e]),"register"!==y.type)throw"DEC does not support this operand";A=u(a.DEC_REG_A,y.value),h.push(A);break;case"CMP":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.CMP_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.CMP_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.CMP_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"CMP does not support this operands";A=u(a.CMP_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;case"JMP":if(y=r(x[d]),t("JMP",x[e]),"register"===y.type)A=a.JMP_REGADDRESS;else{if("number"!==y.type)throw"JMP does not support this operands";A=a.JMP_ADDRESS}h.push(A,y.value);break;case"JC":case"JB":case"JNAE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JC_REGADDRESS;else{if("number"!==y.type)throw B+" does not support this operand";A=a.JC_ADDRESS}h.push(A,y.value);break;case"JNC":case"JNB":case"JAE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JNC_REGADDRESS;else{if("number"!==y.type)throw B+"does not support this operand";A=a.JNC_ADDRESS}h.push(A,y.value);break;case"JZ":case"JE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JZ_REGADDRESS;else{if("number"!==y.type)throw B+" does not support this operand";A=a.JZ_ADDRESS}h.push(A,y.value);break;case"JNZ":case"JNE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JNZ_REGADDRESS;else{if("number"!==y.type)throw B+" does not support this operand";A=a.JNZ_ADDRESS}h.push(A,y.value);break;case"JA":case"JNBE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JA_REGADDRESS;else{if("number"!==y.type)throw B+" does not support this operand";A=a.JA_ADDRESS}h.push(A,y.value);break;case"JNA":case"JBE":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.JNA_REGADDRESS;else{if("number"!==y.type)throw B+" does not support this operand";A=a.JNA_ADDRESS}h.push(A,y.value);break;case"PUSH":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=u(a.PUSH_REG_A,y.value);else if("regaddress"===y.type)A=a.PUSH_REGADDRESS;else if("address"===y.type)A=a.PUSH_ADDRESS;else{if("number"!==y.type)throw"PUSH does not support this operand";A=a.PUSH_NUMBER}"register"===y.type?h.push(A):h.push(A,y.value);break;case"POP":if(y=r(x[d]),t(B,x[e]),"register"!==y.type)throw"PUSH does not support this operand";A=u(a.POP_REG_A,y.value),"register"===y.type?h.push(A):h.push(A,y.value);break;case"CALL":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=a.CALL_REGADDRESS;else{if("number"!==y.type)throw"CALL does not support this operand";A=a.CALL_ADDRESS}h.push(A,y.value);break;case"RET":t(B,x[d]),A=a.RET,h.push(A);break;case"MUL":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=u(a.MUL_REG_A,y.value);else if("regaddress"===y.type)A=a.MUL_REGADDRESS;else if("address"===y.type)A=a.MUL_ADDRESS;else{if("number"!==y.type)throw"MULL does not support this operand";A=a.MUL_NUMBER}h.push(A),"register"!==y.type&&h.push(y.value);break;case"DIV":if(y=r(x[d]),t(B,x[e]),"register"===y.type)A=u(a.DIV_REG_A,y.value);else if("regaddress"===y.type)A=a.DIV_REGADDRESS;else if("address"===y.type)A=a.DIV_ADDRESS;else{if("number"!==y.type)throw"DIV does not support this operand";A=a.DIV_NUMBER}h.push(A),"register"!==y.type&&h.push(y.value);break;case"AND":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.AND_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.AND_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.AND_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"AND does not support this operands";A=u(a.AND_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;case"OR":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.OR_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.OR_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.OR_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"OR does not support this operands";A=u(a.OR_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;case"XOR":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.XOR_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.XOR_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.XOR_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw"XOR does not support this operands";A=u(a.XOR_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;case"NOT":if(y=r(x[d]),t(B,x[e]),"register"!==y.type)throw"NOT does not support this operand";A=u(a.NOT_REG_A,y.value),h.push(A);break;case"SHL":case"SAL":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.SHL_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.SHL_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.SHL_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw B+" does not support this operands";A=u(a.SHL_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;case"SHR":case"SAR":if(y=r(x[d]),z=r(x[e]),"register"===y.type&&"register"===z.type)A=u(a.SHR_REG_WITH_REG_A,y.value);else if("register"===y.type&&"regaddress"===z.type)A=u(a.SHR_REGADDRESS_WITH_REG_A,y.value);else if("register"===y.type&&"address"===z.type)A=u(a.SHR_ADDRESS_WITH_REG_A,y.value);else{if("register"!==y.type||"number"!==z.type)throw B+" does not support this operands";A=u(a.SHR_NUMBER_WITH_REG_A,y.value)}h.push(A,z.value);break;default:throw"Invalid instruction: "+x[2]}}}else{var E=l[v].trim();if(""!==E&&";"!==E.slice(0,1))throw"Syntax error"}}catch(F){throw{error:F,line:v}}for(v=0,w=h.length;w>v;v++)if(!angular.isNumber(h[v])){if(!(h[v]in j))throw{error:"Undefined label: "+h[v]};h[v]=j[h[v]]}return{code:h,mapping:i,labels:j}}}}]),app.service("cpu",["opcodes","memory",function(a,b){var c={step:function(){var c=this;if(c.fault===!0)throw"FAULT. Reset to continue.";try{var d=function(a){if(0>a||a>=c.gpr.length)throw"Invalid register: "+a;return a},e=function(a){if(0>a||a>=1+c.gpr.length)throw"Invalid register: "+a;return a},f=function(a,b){if(a>=0&&a<c.gpr.length)c.gpr[a]=b;else{if(a!=c.gpr.length)throw"Invalid register: "+a;if(c.sp=b,c.sp<c.minSP)throw"Stack overflow";if(c.sp>c.maxSP)throw"Stack underflow"}},g=function(a){if(a>=0&&a<c.gpr.length)return c.gpr[a];if(a==c.gpr.length)return c.sp;throw"Invalid register: "+a},h=function(a){var b,d=a%8;b=d<c.gpr.length?c.gpr[d]:c.sp;var e=Math.floor(a/8);return e>15&&(e-=32),b+e},i=function(a){return c.zero=!1,c.carry=!1,a>=256?(c.carry=!0,a%=256):0===a?c.zero=!0:0>a&&(c.carry=!0,a=256- -a%256),a},j=function(a){if(0>a||a>=b.data.length)throw"IP outside memory";c.ip=a},k=function(a){if(b.store(c.sp--,a),c.sp<c.minSP)throw"Stack overflow"},l=function(){var a=b.load(++c.sp);if(c.sp>c.maxSP)throw"Stack underflow";return a},m=function(a){if(0===a)throw"Division by 0";return Math.floor(c.gpr[0]/a)};if(c.ip<0||c.ip>=b.data.length)throw"Instruction pointer is outside of memory";var n,o,p,q,r,s=b.load(c.ip);switch(s){case a.NONE:return!1;case a.MOV_REG_TO_REG_A:n=0,o=e(b.load(++c.ip)),f(n,g(o)),c.ip++;break;case a.MOV_REG_TO_REG_B:n=1,o=e(b.load(++c.ip)),f(n,g(o)),c.ip++;break;case a.MOV_REG_TO_REG_C:n=2,o=e(b.load(++c.ip)),f(n,g(o)),c.ip++;break;case a.MOV_REG_TO_REG_D:n=3,o=e(b.load(++c.ip)),f(n,g(o)),c.ip++;break;case a.MOV_REG_TO_REG_SP:n=4,o=e(b.load(++c.ip)),f(n,g(o)),c.ip++;break;case a.MOV_ADDRESS_TO_REG_A:n=0,p=b.load(++c.ip),f(n,b.load(p)),c.ip++;break;case a.MOV_ADDRESS_TO_REG_B:n=1,p=b.load(++c.ip),f(n,b.load(p)),c.ip++;break;case a.MOV_ADDRESS_TO_REG_C:n=2,p=b.load(++c.ip),f(n,b.load(p)),c.ip++;break;case a.MOV_ADDRESS_TO_REG_D:n=3,p=b.load(++c.ip),f(n,b.load(p)),c.ip++;break;case a.MOV_ADDRESS_TO_REG_SP:n=4,p=b.load(++c.ip),f(n,b.load(p)),c.ip++;break;case a.MOV_REGADDRESS_TO_REG_A:n=0,o=b.load(++c.ip),f(n,b.load(h(o))),c.ip++;break;case a.MOV_REGADDRESS_TO_REG_B:n=1,o=b.load(++c.ip),f(n,b.load(h(o))),c.ip++;break;case a.MOV_REGADDRESS_TO_REG_C:n=2,o=b.load(++c.ip),f(n,b.load(h(o))),c.ip++;break;case a.MOV_REGADDRESS_TO_REG_D:n=3,o=b.load(++c.ip),f(n,b.load(h(o))),c.ip++;break;case a.MOV_REGADDRESS_TO_REG_SP:n=4,o=b.load(++c.ip),f(n,b.load(h(o))),c.ip++;break;case a.MOV_REG_TO_ADDRESS_A:o=0,q=b.load(++c.ip),b.store(q,g(o)),c.ip++;break;case a.MOV_REG_TO_ADDRESS_B:o=1,q=b.load(++c.ip),b.store(q,g(o)),c.ip++;break;case a.MOV_REG_TO_ADDRESS_C:o=2,q=b.load(++c.ip),b.store(q,g(o)),c.ip++;break;case a.MOV_REG_TO_ADDRESS_D:o=3,q=b.load(++c.ip),b.store(q,g(o)),c.ip++;break;case a.MOV_REG_TO_ADDRESS_SP:o=4,q=b.load(++c.ip),b.store(q,g(o)),c.ip++;break;case a.MOV_REG_TO_REGADDRESS_A:o=0,n=b.load(++c.ip),b.store(h(n),g(o)),c.ip++;break;case a.MOV_REG_TO_REGADDRESS_B:o=1,n=b.load(++c.ip),b.store(h(n),g(o)),c.ip++;break;case a.MOV_REG_TO_REGADDRESS_C:o=2,n=b.load(++c.ip),b.store(h(n),g(o)),c.ip++;break;case a.MOV_REG_TO_REGADDRESS_D:o=3,n=b.load(++c.ip),b.store(h(n),g(o)),c.ip++;break;case a.MOV_REG_TO_REGADDRESS_SP:o=4,n=b.load(++c.ip),b.store(h(n),g(o)),c.ip++;break;case a.MOV_NUMBER_TO_REG_A:n=0,r=b.load(++c.ip),f(n,r),c.ip++;break;case a.MOV_NUMBER_TO_REG_B:n=1,r=b.load(++c.ip),f(n,r),c.ip++;break;case a.MOV_NUMBER_TO_REG_C:n=2,r=b.load(++c.ip),f(n,r),c.ip++;break;case a.MOV_NUMBER_TO_REG_D:n=3,r=b.load(++c.ip),f(n,r),c.ip++;break;case a.MOV_NUMBER_TO_REG_SP:n=4,r=b.load(++c.ip),f(n,r),c.ip++;break;case a.MOV_NUMBER_TO_ADDRESS:q=b.load(++c.ip),r=b.load(++c.ip),b.store(q,r),c.ip++;break;case a.MOV_NUMBER_TO_REGADDRESS:n=b.load(++c.ip),r=b.load(++c.ip),b.store(h(n),r),c.ip++;break;case a.ADD_REG_TO_REG_A:n=0,o=e(b.load(++c.ip)),f(n,i(g(n)+g(o))),c.ip++;break;case a.ADD_REG_TO_REG_B:n=1,o=e(b.load(++c.ip)),f(n,i(g(n)+g(o))),c.ip++;break;case a.ADD_REG_TO_REG_C:n=2,o=e(b.load(++c.ip)),f(n,i(g(n)+g(o))),c.ip++;break;case a.ADD_REG_TO_REG_D:n=3,o=e(b.load(++c.ip)),f(n,i(g(n)+g(o))),c.ip++;break;case a.ADD_REG_TO_REG_SP:n=4,o=e(b.load(++c.ip)),f(n,i(g(n)+g(o))),c.ip++;break;case a.ADD_REGADDRESS_TO_REG_A:n=0,o=b.load(++c.ip),f(n,i(g(n)+b.load(h(o)))),c.ip++;break;case a.ADD_REGADDRESS_TO_REG_B:n=1,o=b.load(++c.ip),f(n,i(g(n)+b.load(h(o)))),c.ip++;break;case a.ADD_REGADDRESS_TO_REG_C:n=2,o=b.load(++c.ip),f(n,i(g(n)+b.load(h(o)))),c.ip++;break;case a.ADD_REGADDRESS_TO_REG_D:n=3,o=b.load(++c.ip),f(n,i(g(n)+b.load(h(o)))),c.ip++;break;case a.ADD_REGADDRESS_TO_REG_SP:n=4,o=b.load(++c.ip),f(n,i(g(n)+b.load(h(o)))),c.ip++;break;case a.ADD_ADDRESS_TO_REG_A:n=0,p=b.load(++c.ip),f(n,i(g(n)+b.load(p))),c.ip++;break;case a.ADD_ADDRESS_TO_REG_B:n=1,p=b.load(++c.ip),f(n,i(g(n)+b.load(p))),c.ip++;break;case a.ADD_ADDRESS_TO_REG_C:n=2,p=b.load(++c.ip),f(n,i(g(n)+b.load(p))),c.ip++;break;case a.ADD_ADDRESS_TO_REG_D:n=3,p=b.load(++c.ip),f(n,i(g(n)+b.load(p))),c.ip++;break;case a.ADD_ADDRESS_TO_REG_SP:n=4,p=b.load(++c.ip),f(n,i(g(n)+b.load(p))),c.ip++;break;case a.ADD_NUMBER_TO_REG_A:n=0,r=b.load(++c.ip),f(n,i(g(n)+r)),c.ip++;break;case a.ADD_NUMBER_TO_REG_B:n=1,r=b.load(++c.ip),f(n,i(g(n)+r)),c.ip++;break;case a.ADD_NUMBER_TO_REG_C:n=2,r=b.load(++c.ip),f(n,i(g(n)+r)),c.ip++;break;case a.ADD_NUMBER_TO_REG_D:n=3,r=b.load(++c.ip),f(n,i(g(n)+r)),c.ip++;break;case a.ADD_NUMBER_TO_REG_SP:n=4,r=b.load(++c.ip),f(n,i(g(n)+r)),c.ip++;break;case a.SUB_REG_FROM_REG_A:n=0,o=e(b.load(++c.ip)),f(n,i(g(n)-c.gpr[o])),c.ip++;break;case a.SUB_REG_FROM_REG_B:n=1,o=e(b.load(++c.ip)),f(n,i(g(n)-c.gpr[o])),c.ip++;break;case a.SUB_REG_FROM_REG_C:n=2,o=e(b.load(++c.ip)),f(n,i(g(n)-c.gpr[o])),c.ip++;break;case a.SUB_REG_FROM_REG_D:n=3,o=e(b.load(++c.ip)),f(n,i(g(n)-c.gpr[o])),c.ip++;break;case a.SUB_REG_FROM_REG_SP:n=4,o=e(b.load(++c.ip)),f(n,i(g(n)-c.gpr[o])),c.ip++;break;case a.SUB_REGADDRESS_FROM_REG_A:n=0,o=b.load(++c.ip),f(n,i(g(n)-b.load(h(o)))),c.ip++;break;case a.SUB_REGADDRESS_FROM_REG_B:n=1,o=b.load(++c.ip),f(n,i(g(n)-b.load(h(o)))),c.ip++;break;case a.SUB_REGADDRESS_FROM_REG_C:n=2,o=b.load(++c.ip),f(n,i(g(n)-b.load(h(o)))),c.ip++;break;case a.SUB_REGADDRESS_FROM_REG_D:n=3,o=b.load(++c.ip),f(n,i(g(n)-b.load(h(o)))),c.ip++;break;case a.SUB_REGADDRESS_FROM_REG_SP:n=4,o=b.load(++c.ip),f(n,i(g(n)-b.load(h(o)))),c.ip++;break;case a.SUB_ADDRESS_FROM_REG_A:n=0,p=b.load(++c.ip),f(n,i(g(n)-b.load(p))),c.ip++;break;case a.SUB_ADDRESS_FROM_REG_B:n=1,p=b.load(++c.ip),f(n,i(g(n)-b.load(p))),c.ip++;break;case a.SUB_ADDRESS_FROM_REG_C:n=2,p=b.load(++c.ip),f(n,i(g(n)-b.load(p))),c.ip++;break;case a.SUB_ADDRESS_FROM_REG_D:n=3,p=b.load(++c.ip),f(n,i(g(n)-b.load(p))),c.ip++;break;case a.SUB_ADDRESS_FROM_REG_SP:n=4,p=b.load(++c.ip),f(n,i(g(n)-b.load(p))),c.ip++;break;case a.SUB_NUMBER_FROM_REG_A:n=0,r=b.load(++c.ip),f(n,i(g(n)-r)),c.ip++;break;case a.SUB_NUMBER_FROM_REG_B:n=1,r=b.load(++c.ip),f(n,i(g(n)-r)),c.ip++;break;case a.SUB_NUMBER_FROM_REG_C:n=2,r=b.load(++c.ip),f(n,i(g(n)-r)),c.ip++;break;case a.SUB_NUMBER_FROM_REG_D:n=3,r=b.load(++c.ip),f(n,i(g(n)-r)),c.ip++;break;case a.SUB_NUMBER_FROM_REG_SP:n=4,r=b.load(++c.ip),f(n,i(g(n)-r)),c.ip++;break;case a.INC_REG_A:n=0,f(n,i(g(n)+1)),c.ip++;break;case a.INC_REG_B:n=1,f(n,i(g(n)+1)),c.ip++;break;case a.INC_REG_C:n=2,f(n,i(g(n)+1)),c.ip++;break;case a.INC_REG_D:n=3,f(n,i(g(n)+1)),c.ip++;break;case a.INC_REG_SP:n=4,f(n,i(g(n)+1)),c.ip++;break;case a.DEC_REG_A:n=0,f(n,i(g(n)-1)),c.ip++;break;case a.DEC_REG_B:n=1,f(n,i(g(n)-1)),c.ip++;break;case a.DEC_REG_C:n=2,f(n,i(g(n)-1)),c.ip++;break;case a.DEC_REG_D:n=3,f(n,i(g(n)-1)),c.ip++;break;case a.DEC_REG_SP:n=4,f(n,i(g(n)-1)),c.ip++;break;case a.CMP_REG_WITH_REG_A:n=0,o=e(b.load(++c.ip)),i(g(n)-g(o)),c.ip++;break;case a.CMP_REG_WITH_REG_B:n=1,o=e(b.load(++c.ip)),i(g(n)-g(o)),c.ip++;break;case a.CMP_REG_WITH_REG_C:n=2,o=e(b.load(++c.ip)),i(g(n)-g(o)),c.ip++;break;case a.CMP_REG_WITH_REG_D:n=3,o=e(b.load(++c.ip)),i(g(n)-g(o)),c.ip++;break;case a.CMP_REG_WITH_REG_SP:n=4,o=e(b.load(++c.ip)),i(g(n)-g(o)),c.ip++;break;case a.CMP_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),i(g(n)-b.load(h(o))),c.ip++;break;case a.CMP_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),i(g(n)-b.load(h(o))),c.ip++;break;case a.CMP_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),i(g(n)-b.load(h(o))),c.ip++;break;case a.CMP_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),i(g(n)-b.load(h(o))),c.ip++;break;case a.CMP_REGADDRESS_WITH_REG_SP:n=4,o=b.load(++c.ip),i(g(n)-b.load(h(o))),c.ip++;break;case a.CMP_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),i(g(n)-b.load(p)),c.ip++;break;case a.CMP_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),i(g(n)-b.load(p)),c.ip++;break;case a.CMP_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),i(g(n)-b.load(p)),c.ip++;break;case a.CMP_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),i(g(n)-b.load(p)),c.ip++;break;case a.CMP_ADDRESS_WITH_REG_SP:n=4,p=b.load(++c.ip),i(g(n)-b.load(p)),c.ip++;break;case a.CMP_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),i(g(n)-r),c.ip++;break;case a.CMP_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),i(g(n)-r),c.ip++;break;case a.CMP_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),i(g(n)-r),c.ip++;break;case a.CMP_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),i(g(n)-r),c.ip++;break;case a.CMP_NUMBER_WITH_REG_SP:n=4,r=b.load(++c.ip),i(g(n)-r),c.ip++;break;case a.JMP_REGADDRESS:n=d(b.load(++c.ip)),j(c.gpr[n]);break;case a.JMP_ADDRESS:r=b.load(++c.ip),j(r);break;case a.JC_REGADDRESS:n=d(b.load(++c.ip)),c.carry?j(c.gpr[n]):c.ip++;break;case a.JC_ADDRESS:r=b.load(++c.ip),c.carry?j(r):c.ip++;break;case a.JNC_REGADDRESS:n=d(b.load(++c.ip)),c.carry?c.ip++:j(c.gpr[n]);break;case a.JNC_ADDRESS:r=b.load(++c.ip),c.carry?c.ip++:j(r);break;case a.JZ_REGADDRESS:n=d(b.load(++c.ip)),c.zero?j(c.gpr[n]):c.ip++;break;case a.JZ_ADDRESS:r=b.load(++c.ip),c.zero?j(r):c.ip++;break;case a.JNZ_REGADDRESS:n=d(b.load(++c.ip)),c.zero?c.ip++:j(c.gpr[n]);break;case a.JNZ_ADDRESS:r=b.load(++c.ip),c.zero?c.ip++:j(r);break;case a.JA_REGADDRESS:n=d(b.load(++c.ip)),c.zero||c.carry?c.ip++:j(c.gpr[n]);break;case a.JA_ADDRESS:r=b.load(++c.ip),c.zero||c.carry?c.ip++:j(r);break;case a.JNA_REGADDRESS:n=d(b.load(++c.ip)),c.zero||c.carry?j(c.gpr[n]):c.ip++;break;case a.JNA_ADDRESS:r=b.load(++c.ip),c.zero||c.carry?j(r):c.ip++;break;case a.PUSH_REG_A:k(c.gpr[0]),c.ip++;break;case a.PUSH_REG_B:k(c.gpr[1]),c.ip++;break;case a.PUSH_REG_C:k(c.gpr[2]),c.ip++;break;case a.PUSH_REG_D:k(c.gpr[3]),c.ip++;break;case a.PUSH_REGADDRESS:o=b.load(++c.ip),k(b.load(h(o))),c.ip++;break;case a.PUSH_ADDRESS:p=b.load(++c.ip),k(b.load(p)),c.ip++;break;case a.PUSH_NUMBER:r=b.load(++c.ip),k(r),c.ip++;break;case a.POP_REG_A:c.gpr[0]=l(),c.ip++;break;case a.POP_REG_B:c.gpr[1]=l(),c.ip++;break;case a.POP_REG_C:c.gpr[2]=l(),c.ip++;break;case a.POP_REG_D:c.gpr[3]=l(),c.ip++;break;case a.CALL_REGADDRESS:n=d(b.load(++c.ip)),k(c.ip+1),j(c.gpr[n]);break;case a.CALL_ADDRESS:r=b.load(++c.ip),k(c.ip+1),j(r);break;case a.RET:j(l());break;case a.MUL_REG_A:o=0,c.gpr[0]=i(c.gpr[0]*c.gpr[o]),c.ip++;break;case a.MUL_REG_B:o=1,c.gpr[0]=i(c.gpr[0]*c.gpr[o]),c.ip++;break;case a.MUL_REG_C:o=2,c.gpr[0]=i(c.gpr[0]*c.gpr[o]),c.ip++;break;case a.MUL_REG_D:o=3,c.gpr[0]=i(c.gpr[0]*c.gpr[o]),c.ip++;break;case a.MUL_REGADDRESS:o=b.load(++c.ip),c.gpr[0]=i(c.gpr[0]*b.load(h(o))),c.ip++;break;case a.MUL_ADDRESS:p=b.load(++c.ip),c.gpr[0]=i(c.gpr[0]*b.load(p)),c.ip++;break;case a.MUL_NUMBER:r=b.load(++c.ip),c.gpr[0]=i(c.gpr[0]*r),c.ip++;break;case a.DIV_REG_A:o=0,c.gpr[0]=i(m(c.gpr[o])),c.ip++;break;case a.DIV_REG_B:o=1,c.gpr[0]=i(m(c.gpr[o])),c.ip++;break;case a.DIV_REG_C:o=2,c.gpr[0]=i(m(c.gpr[o])),c.ip++;break;case a.DIV_REG_D:o=3,c.gpr[0]=i(m(c.gpr[o])),c.ip++;break;case a.DIV_REGADDRESS:o=b.load(++c.ip),c.gpr[0]=i(m(b.load(h(o)))),c.ip++;break;case a.DIV_ADDRESS:p=b.load(++c.ip),c.gpr[0]=i(m(b.load(p))),c.ip++;break;case a.DIV_NUMBER:r=b.load(++c.ip),c.gpr[0]=i(m(r)),c.ip++;break;case a.AND_REG_WITH_REG_A:n=0,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]&c.gpr[o]),c.ip++;break;case a.AND_REG_WITH_REG_B:n=1,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]&c.gpr[o]),c.ip++;break;case a.AND_REG_WITH_REG_C:n=2,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]&c.gpr[o]),c.ip++;break;case a.AND_REG_WITH_REG_D:n=3,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]&c.gpr[o]),c.ip++;break;case a.AND_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(h(o))),c.ip++;break;case a.AND_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(h(o))),c.ip++;break;case a.AND_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(h(o))),c.ip++;break;case a.AND_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(h(o))),c.ip++;break;case a.AND_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(p)),c.ip++;break;case a.AND_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(p)),c.ip++;break;case a.AND_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(p)),c.ip++;break;case a.AND_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&b.load(p)),c.ip++;break;case a.AND_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&r),c.ip++;break;case a.AND_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&r),c.ip++;break;case a.AND_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&r),c.ip++;break;case a.AND_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]&r),c.ip++;break;case a.OR_REG_WITH_REG_A:n=0,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]|c.gpr[o]),c.ip++;break;case a.OR_REG_WITH_REG_B:n=1,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]|c.gpr[o]),c.ip++;break;case a.OR_REG_WITH_REG_C:n=2,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]|c.gpr[o]),c.ip++;break;case a.OR_REG_WITH_REG_D:n=3,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]|c.gpr[o]),c.ip++;break;case a.OR_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(h(o))),c.ip++;break;case a.OR_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(h(o))),c.ip++;break;case a.OR_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(h(o))),c.ip++;break;case a.OR_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(h(o))),c.ip++;break;case a.OR_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(p)),c.ip++;break;case a.OR_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(p)),c.ip++;break;case a.OR_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(p)),c.ip++;break;case a.OR_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|b.load(p)),c.ip++;break;case a.OR_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|r),c.ip++;break;case a.OR_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|r),c.ip++;break;case a.OR_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|r),c.ip++;break;case a.OR_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]|r),c.ip++;break;case a.XOR_REG_WITH_REG_A:n=0,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]^c.gpr[o]),c.ip++;break;case a.XOR_REG_WITH_REG_B:n=1,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]^c.gpr[o]),c.ip++;break;case a.XOR_REG_WITH_REG_C:n=2,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]^c.gpr[o]),c.ip++;break;case a.XOR_REG_WITH_REG_D:n=3,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]^c.gpr[o]),c.ip++;break;case a.XOR_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(h(o))),c.ip++;break;case a.XOR_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(h(o))),c.ip++;break;case a.XOR_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(h(o))),c.ip++;break;case a.XOR_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(h(o))),c.ip++;break;case a.XOR_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(p)),c.ip++;break;case a.XOR_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(p)),c.ip++;break;case a.XOR_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(p)),c.ip++;break;case a.XOR_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^b.load(p)),c.ip++;break;case a.XOR_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^r),c.ip++;break;case a.XOR_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^r),c.ip++;break;case a.XOR_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^r),c.ip++;break;case a.XOR_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]^r),c.ip++;break;case a.NOT_REG_A:n=0,c.gpr[n]=i(~c.gpr[n]),c.ip++;break;case a.NOT_REG_B:n=1,c.gpr[n]=i(~c.gpr[n]),c.ip++;break;case a.NOT_REG_C:n=2,c.gpr[n]=i(~c.gpr[n]),c.ip++;break;case a.NOT_REG_D:n=3,c.gpr[n]=i(~c.gpr[n]),c.ip++;break;case a.SHL_REG_WITH_REG_A:n=0,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]<<c.gpr[o]),c.ip++;break;case a.SHL_REG_WITH_REG_B:n=1,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]<<c.gpr[o]),c.ip++;break;case a.SHL_REG_WITH_REG_C:n=2,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]<<c.gpr[o]),c.ip++;break;case a.SHL_REG_WITH_REG_D:n=3,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]<<c.gpr[o]),c.ip++;break;case a.SHL_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(h(o))),c.ip++;break;case a.SHL_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(h(o))),c.ip++;break;case a.SHL_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(h(o))),c.ip++;break;case a.SHL_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(h(o))),c.ip++;break;case a.SHL_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(p)),c.ip++;break;case a.SHL_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(p)),c.ip++;break;case a.SHL_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(p)),c.ip++;break;case a.SHL_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<b.load(p)),c.ip++;break;case a.SHL_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<r),c.ip++;break;case a.SHL_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<r),c.ip++;break;case a.SHL_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<r),c.ip++;break;case a.SHL_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]<<r),c.ip++;break;case a.SHR_REG_WITH_REG_A:n=0,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]>>>c.gpr[o]),c.ip++;break;case a.SHR_REG_WITH_REG_B:n=1,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]>>>c.gpr[o]),c.ip++;break;case a.SHR_REG_WITH_REG_C:n=2,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]>>>c.gpr[o]),c.ip++;break;case a.SHR_REG_WITH_REG_D:n=3,o=d(b.load(++c.ip)),c.gpr[n]=i(c.gpr[n]>>>c.gpr[o]),c.ip++;break;case a.SHR_REGADDRESS_WITH_REG_A:n=0,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(h(o))),c.ip++;break;case a.SHR_REGADDRESS_WITH_REG_B:n=1,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(h(o))),c.ip++;break;case a.SHR_REGADDRESS_WITH_REG_C:n=2,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(h(o))),c.ip++;break;case a.SHR_REGADDRESS_WITH_REG_D:n=3,o=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(h(o))),c.ip++;break;case a.SHR_ADDRESS_WITH_REG_A:n=0,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(p)),c.ip++;break;case a.SHR_ADDRESS_WITH_REG_B:n=1,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(p)),c.ip++;break;case a.SHR_ADDRESS_WITH_REG_C:n=2,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(p)),c.ip++;break;case a.SHR_ADDRESS_WITH_REG_D:n=3,p=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>b.load(p)),c.ip++;break;case a.SHR_NUMBER_WITH_REG_A:n=0,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>r),c.ip++;break;case a.SHR_NUMBER_WITH_REG_B:n=1,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>r),c.ip++;break;case a.SHR_NUMBER_WITH_REG_C:n=2,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>r),c.ip++;break;case a.SHR_NUMBER_WITH_REG_D:n=3,r=b.load(++c.ip),c.gpr[n]=i(c.gpr[n]>>>r),c.ip++;break;default:throw"Invalid op code: "+s}return!0}catch(t){throw c.fault=!0,t}},reset:function(){var a=this;a.maxSP=231,a.minSP=0,a.gpr=[0,0,0,0],a.sp=a.maxSP,a.ip=0,a.zero=!1,a.carry=!1,a.fault=!1}};return c.reset(),c}]),app.service("memory",[function(){var a={data:Array(256),lastAccess:-1,load:function(a){var b=this;if(0>a||a>=b.data.length)throw"Memory access violation at "+a;return b.lastAccess=a,b.data[a]},store:function(a,b){var c=this;if(0>a||a>=c.data.length)throw"Memory access violation at "+a;c.lastAccess=a,c.data[a]=b},reset:function(){var a=this;a.lastAccess=-1;for(var b=0,c=a.data.length;c>b;b++)a.data[b]=0}};return a.reset(),a}]),app.service("opcodes",[function(){var a={NONE:0,MOV_REG_TO_REG_A:1,MOV_REG_TO_REG_B:2,MOV_REG_TO_REG_C:3,MOV_REG_TO_REG_D:4,MOV_REG_TO_REG_SP:5,MOV_ADDRESS_TO_REG_A:6,MOV_ADDRESS_TO_REG_B:7,MOV_ADDRESS_TO_REG_C:8,MOV_ADDRESS_TO_REG_D:9,MOV_ADDRESS_TO_REG_SP:10,MOV_REGADDRESS_TO_REG_A:11,MOV_REGADDRESS_TO_REG_B:12,MOV_REGADDRESS_TO_REG_C:13,MOV_REGADDRESS_TO_REG_D:14,MOV_REGADDRESS_TO_REG_SP:15,MOV_REG_TO_ADDRESS_A:16,MOV_REG_TO_ADDRESS_B:17,MOV_REG_TO_ADDRESS_C:18,MOV_REG_TO_ADDRESS_D:19,MOV_REG_TO_ADDRESS_SP:20,MOV_REG_TO_REGADDRESS_A:21,MOV_REG_TO_REGADDRESS_B:22,MOV_REG_TO_REGADDRESS_C:23,MOV_REG_TO_REGADDRESS_D:24,MOV_REG_TO_REGADDRESS_SP:25,MOV_NUMBER_TO_REG_A:26,MOV_NUMBER_TO_REG_B:27,MOV_NUMBER_TO_REG_C:28,MOV_NUMBER_TO_REG_D:29,MOV_NUMBER_TO_REG_SP:30,MOV_NUMBER_TO_ADDRESS:31,MOV_NUMBER_TO_REGADDRESS:32,ADD_REG_TO_REG_A:33,ADD_REG_TO_REG_B:34,ADD_REG_TO_REG_C:35,ADD_REG_TO_REG_D:36,ADD_REG_TO_REG_SP:37,ADD_REGADDRESS_TO_REG_A:38,ADD_REGADDRESS_TO_REG_B:39,ADD_REGADDRESS_TO_REG_C:40,ADD_REGADDRESS_TO_REG_D:41,ADD_REGADDRESS_TO_REG_SP:42,ADD_ADDRESS_TO_REG_A:43,ADD_ADDRESS_TO_REG_B:44,ADD_ADDRESS_TO_REG_C:45,ADD_ADDRESS_TO_REG_D:46,ADD_ADDRESS_TO_REG_SP:47,ADD_NUMBER_TO_REG_A:48,ADD_NUMBER_TO_REG_B:49,ADD_NUMBER_TO_REG_C:50,ADD_NUMBER_TO_REG_D:51,ADD_NUMBER_TO_REG_SP:52,SUB_REG_FROM_REG_A:53,SUB_REG_FROM_REG_B:54,SUB_REG_FROM_REG_C:55,SUB_REG_FROM_REG_D:56,SUB_REG_FROM_REG_SP:57,SUB_REGADDRESS_FROM_REG_A:58,
SUB_REGADDRESS_FROM_REG_B:59,SUB_REGADDRESS_FROM_REG_C:60,SUB_REGADDRESS_FROM_REG_D:61,SUB_REGADDRESS_FROM_REG_SP:62,SUB_ADDRESS_FROM_REG_A:63,SUB_ADDRESS_FROM_REG_B:64,SUB_ADDRESS_FROM_REG_C:65,SUB_ADDRESS_FROM_REG_D:66,SUB_ADDRESS_FROM_REG_SP:67,SUB_NUMBER_FROM_REG_A:68,SUB_NUMBER_FROM_REG_B:69,SUB_NUMBER_FROM_REG_C:70,SUB_NUMBER_FROM_REG_D:71,SUB_NUMBER_FROM_REG_SP:72,INC_REG_A:73,INC_REG_B:74,INC_REG_C:75,INC_REG_D:76,INC_REG_SP:77,DEC_REG_A:78,DEC_REG_B:79,DEC_REG_C:80,DEC_REG_D:81,DEC_REG_SP:82,CMP_REG_WITH_REG_A:83,CMP_REG_WITH_REG_B:84,CMP_REG_WITH_REG_C:85,CMP_REG_WITH_REG_D:86,CMP_REG_WITH_REG_SP:87,CMP_REGADDRESS_WITH_REG_A:88,CMP_REGADDRESS_WITH_REG_B:89,CMP_REGADDRESS_WITH_REG_C:90,CMP_REGADDRESS_WITH_REG_D:91,CMP_REGADDRESS_WITH_REG_SP:92,CMP_ADDRESS_WITH_REG_A:93,CMP_ADDRESS_WITH_REG_B:94,CMP_ADDRESS_WITH_REG_C:95,CMP_ADDRESS_WITH_REG_D:96,CMP_ADDRESS_WITH_REG_SP:97,CMP_NUMBER_WITH_REG_A:98,CMP_NUMBER_WITH_REG_B:99,CMP_NUMBER_WITH_REG_C:100,CMP_NUMBER_WITH_REG_D:101,CMP_NUMBER_WITH_REG_SP:102,JMP_ADDRESS:103,JMP_REGADDRESS:104,JC_ADDRESS:105,JC_REGADDRESS:106,JNC_ADDRESS:107,JNC_REGADDRESS:108,JZ_ADDRESS:109,JZ_REGADDRESS:110,JNZ_ADDRESS:111,JNZ_REGADDRESS:112,JA_ADDRESS:113,JA_REGADDRESS:114,JNA_ADDRESS:115,JNA_REGADDRESS:116,PUSH_REG_A:117,PUSH_REG_B:118,PUSH_REG_C:119,PUSH_REG_D:120,PUSH_REGADDRESS:121,PUSH_ADDRESS:122,PUSH_NUMBER:123,POP_REG_A:124,POP_REG_B:125,POP_REG_C:126,POP_REG_D:127,CALL_REGADDRESS:128,CALL_ADDRESS:129,RET:130,MUL_REG_A:131,MUL_REG_B:132,MUL_REG_C:133,MUL_REG_D:134,MUL_REGADDRESS:135,MUL_ADDRESS:136,MUL_NUMBER:137,DIV_REG_A:138,DIV_REG_B:139,DIV_REG_C:140,DIV_REG_D:141,DIV_REGADDRESS:142,DIV_ADDRESS:143,DIV_NUMBER:144,AND_REG_WITH_REG_A:145,AND_REG_WITH_REG_B:146,AND_REG_WITH_REG_C:147,AND_REG_WITH_REG_D:148,AND_REGADDRESS_WITH_REG_A:149,AND_REGADDRESS_WITH_REG_B:150,AND_REGADDRESS_WITH_REG_C:151,AND_REGADDRESS_WITH_REG_D:152,AND_ADDRESS_WITH_REG_A:153,AND_ADDRESS_WITH_REG_B:154,AND_ADDRESS_WITH_REG_C:155,AND_ADDRESS_WITH_REG_D:156,AND_NUMBER_WITH_REG_A:157,AND_NUMBER_WITH_REG_B:158,AND_NUMBER_WITH_REG_C:159,AND_NUMBER_WITH_REG_D:160,OR_REG_WITH_REG_A:161,OR_REG_WITH_REG_B:162,OR_REG_WITH_REG_C:163,OR_REG_WITH_REG_D:164,OR_REGADDRESS_WITH_REG_A:165,OR_REGADDRESS_WITH_REG_B:166,OR_REGADDRESS_WITH_REG_C:167,OR_REGADDRESS_WITH_REG_D:168,OR_ADDRESS_WITH_REG_A:169,OR_ADDRESS_WITH_REG_B:170,OR_ADDRESS_WITH_REG_C:171,OR_ADDRESS_WITH_REG_D:172,OR_NUMBER_WITH_REG_A:173,OR_NUMBER_WITH_REG_B:174,OR_NUMBER_WITH_REG_C:175,OR_NUMBER_WITH_REG_D:176,XOR_REG_WITH_REG_A:177,XOR_REG_WITH_REG_B:178,XOR_REG_WITH_REG_C:179,XOR_REG_WITH_REG_D:180,XOR_REGADDRESS_WITH_REG_A:181,XOR_REGADDRESS_WITH_REG_B:182,XOR_REGADDRESS_WITH_REG_C:183,XOR_REGADDRESS_WITH_REG_D:184,XOR_ADDRESS_WITH_REG_A:185,XOR_ADDRESS_WITH_REG_B:186,XOR_ADDRESS_WITH_REG_C:187,XOR_ADDRESS_WITH_REG_D:188,XOR_NUMBER_WITH_REG_A:189,XOR_NUMBER_WITH_REG_B:190,XOR_NUMBER_WITH_REG_C:191,XOR_NUMBER_WITH_REG_D:192,NOT_REG_A:193,NOT_REG_B:194,NOT_REG_C:195,NOT_REG_D:196,SHL_REG_WITH_REG_A:197,SHL_REG_WITH_REG_B:198,SHL_REG_WITH_REG_C:199,SHL_REG_WITH_REG_D:200,SHL_REGADDRESS_WITH_REG_A:201,SHL_REGADDRESS_WITH_REG_B:202,SHL_REGADDRESS_WITH_REG_C:203,SHL_REGADDRESS_WITH_REG_D:204,SHL_ADDRESS_WITH_REG_A:205,SHL_ADDRESS_WITH_REG_B:206,SHL_ADDRESS_WITH_REG_C:207,SHL_ADDRESS_WITH_REG_D:208,SHL_NUMBER_WITH_REG_A:209,SHL_NUMBER_WITH_REG_B:210,SHL_NUMBER_WITH_REG_C:211,SHL_NUMBER_WITH_REG_D:212,SHR_REG_WITH_REG_A:213,SHR_REG_WITH_REG_B:214,SHR_REG_WITH_REG_C:215,SHR_REG_WITH_REG_D:216,SHR_REGADDRESS_WITH_REG_A:217,SHR_REGADDRESS_WITH_REG_B:218,SHR_REGADDRESS_WITH_REG_C:219,SHR_REGADDRESS_WITH_REG_D:220,SHR_ADDRESS_WITH_REG_A:221,SHR_ADDRESS_WITH_REG_B:222,SHR_ADDRESS_WITH_REG_C:223,SHR_ADDRESS_WITH_REG_D:224,SHR_NUMBER_WITH_REG_A:225,SHR_NUMBER_WITH_REG_B:226,SHR_NUMBER_WITH_REG_C:227,SHR_NUMBER_WITH_REG_D:228};return a}]),app.controller("Ctrl",["$document","$scope","$timeout","cpu","memory","assembler",function(a,b,c,d,e,f){b.memory=e,b.cpu=d,b.error="",b.isRunning=!1,b.displayHex=!0,b.displayInstr=!0,b.displayA=!1,b.displayB=!1,b.displayC=!1,b.displayD=!1,b.speeds=[{speed:1,desc:"1 HZ"},{speed:4,desc:"4 HZ"},{speed:8,desc:"8 HZ"},{speed:16,desc:"16 HZ"}],b.speed=4,b.outputStartIndex=232,b.code='; Simple example\n; Writes Hello World to the output\n\n	JMP start\nhello: DB "Hello World!" ; Variable\n       DB 0	; String terminator\n\nstart:\n	MOV C, hello    ; Point to var \n	MOV D, 232	; Point to output\n	CALL print\n        HLT             ; Stop execution\n\nprint:			; print(C:*from, D:*to)\n	PUSH A\n	PUSH B\n	MOV B, 0\n.loop:\n	MOV A, [C]	; Get char from var\n	MOV [D], A	; Write to output\n	INC C\n	INC D  \n	CMP B, [C]	; Check if end\n	JNZ .loop	; jump if not\n\n	POP B\n	POP A\n	RET',b.reset=function(){d.reset(),e.reset(),b.error="",b.selectedLine=-1},b.executeStep=function(){b.checkPrgrmLoaded()||b.assemble();try{var a=d.step();return d.ip in b.mapping&&(b.selectedLine=b.mapping[d.ip]),a}catch(c){return b.error=c,!1}};var g;b.run=function(){b.checkPrgrmLoaded()||b.assemble(),b.isRunning=!0,g=c(function(){b.executeStep()===!0?b.run():b.isRunning=!1},1e3/b.speed)},b.stop=function(){c.cancel(g),b.isRunning=!1},b.checkPrgrmLoaded=function(){for(var a=0,b=e.data.length;b>a;a++)if(0!==e.data[a])return!0;return!1},b.getChar=function(a){var b=String.fromCharCode(a);return""===b.trim()?"  ":b},b.assemble=function(){try{b.reset();var a=f.go(b.code);b.mapping=a.mapping;var c=a.code;if(b.labels=a.labels,c.length>e.data.length)throw"Binary code does not fit into the memory. Max "+e.data.length+" bytes are allowed";for(var d=0,g=c.length;g>d;d++)e.data[d]=c[d]}catch(h){void 0!==h.line?(b.error=h.line+" | "+h.error,b.selectedLine=h.line):b.error=h.error}},b.jumpToLine=function(c){a[0].getElementById("sourceCode").scrollIntoView(),b.selectedLine=b.mapping[c]},b.isInstruction=function(a){return void 0!==b.mapping&&void 0!==b.mapping[a]&&b.displayInstr},b.getMemoryCellCss=function(a){return a>=b.outputStartIndex?"output-bg":b.isInstruction(a)?"instr-bg":a>d.sp&&a<=d.maxSP?"stack-bg":""},b.getMemoryInnerCellCss=function(a){return a===d.ip?"marker marker-ip":a===d.sp?"marker marker-sp":a===d.gpr[0]&&b.displayA?"marker marker-a":a===d.gpr[1]&&b.displayB?"marker marker-b":a===d.gpr[2]&&b.displayC?"marker marker-c":a===d.gpr[3]&&b.displayD?"marker marker-d":""}}]),app.filter("flag",function(){return function(a){return a.toString().toUpperCase()}}),app.filter("number",function(){return function(a,b){if(b){var c=a.toString(16).toUpperCase();return 1==c.length?"0"+c:c}return a.toString(10)}}),app.directive("selectLine",[function(){return{restrict:"A",link:function(a,b,c,d){a.$watch("selectedLine",function(){if(a.selectedLine>=0){for(var c=b[0].value.split("\n"),d=0,e=0;e<c.length&&e!=a.selectedLine;e++)d+=c[e].length+1;var f=c[a.selectedLine].length+d;if("undefined"!=typeof b[0].selectionStart&&(b[0].focus(),b[0].selectionStart=d,b[0].selectionEnd=f),document.selection&&document.selection.createRange){b[0].focus(),b[0].select();var g=document.selection.createRange();g.collapse(!0),g.moveEnd("character",f),g.moveStart("character",d),g.select()}}})}}}]),app.filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}),app.directive("tabSupport",[function(){return{restrict:"A",link:function(a,b,c,d){b.bind("keydown",function(a){if(9===a.keyCode){var b=this.value,c=this.selectionStart,d=this.selectionEnd;return this.value=b.substring(0,c)+"	"+b.substring(d),this.selectionStart=this.selectionEnd=c+1,a.preventDefault(),!1}})}}}]);